sudo: required
dist: xenial
language: php
php:
- 7.1
env:
- NODE_RELEASE=10.x
install:
- composer self-update -q
- composer install
- if [ ! -f .env ]; then cp .env.example .env; fi
- sudo rm -rf ~/.nvm - curl -sL "https://deb.nodesource.com/setup_${NODE_RELEASE}" | sudo -E bash -
- sudo apt-get install -y nodejs
- npm install
script:
- "./vendor/bin/phpunit"
- php artisan js-localization:export
- npm run production
cache:
  directories:
  - vendor
  - node_modules
before_deploy:
# Set up git user name and tag this commit
- git config --local user.name "${GH_USER_NAME}"
- git config --local user.email "${GH_USER_EMAIL}"
- export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
- git tag $TRAVIS_TAG
- zip -r "debrief-$TRAVIS_TAG.zip" -x node_modules . 
deploy:
  provider: releases
  skip_cleanup: true
  draft: true
  api_key:
    secure: HX4bOtdAVm/ZXXKlyK2s3OvZiSVkyN/AxRA2zfizSwJ+1t0s0lny02/+bAl3sUnPmqKJ8rpCUDPYMrdFeKpIMaVWFhTkl1QjEuLvAcMkS2ai/WAp4b3RrFTDsgXBD7B2w6fiqpFdhHqCmZBBuyKDyvgjjQLBtAKaYoDsqZD1YOqFLDfqscoXbi44D6nLuzoIaPo41fNb7GzCtSISxMhBUpI2SPPZNTfWoVb6swwHq7kLGVbCvxdh5E1cQBwN+wCeD/bNn6LMz9VFeOSWTtiF6isUWoGmT/Y1ADpAygVewgVAlFw8oK3itUBT3yShP4kMGd6l/mYBRcWBz08PeuDsp8rpLom6zyIEMkEwPCGr9nV7Cjo1UYRostQ45YrJ6C5xl5wfkJYrZ7OmrpjJi+ZDFyVfSy7xv3tPlUEAPhgrb0hbow1AWqIB1nJFOaBf+t/LzkAGpVPFDy5GpxKoCpozssYVLBef8ETYEs6JnEZTOiahNmm5zU2oWCOieYZGpQo/UYTibGinuF2smavU1ov+VbcFzhVniLlxyr2FfSP28cqc/ugivc/8tWMmaQLFNbrsCwdQiLt196OmgwWIyayTsyrunEIEZZqhZLfDbM78i59kYSFS7WRv+PqzvUPrJqKDx+MR5Kgdgfig43AHeJ6zAPSxRsXQs9rXaqS5sH7kgjk=
  file_glob: true
  file: 
  - "debrief-$TRAVIS_TAG.zip"
  on:
    branch: feature/travis
    repo: dandelionmood/debrief
