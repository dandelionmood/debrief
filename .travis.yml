sudo: required
dist: xenial
language: php
php:
- 7.1
env:
- NODE_RELEASE=10.x
install:
- composer self-update -q
- composer install
- if [ ! -f .env ]; then cp .env.example .env; fi
- sudo rm -rf ~/.nvm - curl -sL "https://deb.nodesource.com/setup_${NODE_RELEASE}"| sudo -E bash -
- sudo apt-get install -y nodejs
- npm install
script:
- "./vendor/bin/phpunit"
- php artisan js-localization:export
- npm run production
cache:
  directories:
  - vendor
  - node_modules
before_deploy:
- git config --local user.name "${GH_USER_NAME}"
- git config --local user.email "${GH_USER_EMAIL}"
- export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
- git tag $TRAVIS_TAG
- zip -r "debrief-$TRAVIS_TAG.zip" . -x"*node_modules*" -x"*.git*"
deploy:
  provider: releases
  skip_cleanup: true
  draft: true
  file_glob: true
  api_key:
    secure: TYMzs4VgOJ6QzCFbSoOdt0mxU+/xKS3nmcERW1+Tp+BZefQR7EikV0cyTdBPpYvmSmaSgI8snMeRkB60COCn6BSXA77xWC4TZDbVDfSa546jcLloDusYEXIZdon0AoOE6fIKqEhXw8kAweep8M66/qrKhXL4sW1HAgCc9DPXM0i4235lw29ZeRup0AVwmSKT51r0XLvCKRArvlXT/LfJPHmUu/JBuPg/+hT7cRJMATxKX9l+TyefeWirPDiJbzGh6gK0DO2h375KoWB7wc3IkMbjIK9Yf9QgRTXjxoteAGS/SXIxLJCWKYamHyXYGKXnnV6D6WRPXBp6OEUdOM4T6hWj+vxOd5sMJ989fOZnyLxpEFrufRecG1c78rjVriXF4qtG6WCHJh2d9VROO3sbgRmQ3ZBdwzjbgfToP7QvGLj+K9590JsuWlVCulNtEWJsLXlWIHvVbm7H+q74Qj1awIY13XQwDrvCk7SGlcgDRwZAWiCbNuA2ALkLuLBlWs77tpaUZBkK9GSMqZCcLO/Fof4/K4gKIAvgZIPxdbxLUS2hGTIHXQGdc7g6cI97eWet22EJQ0cZYMslMlE2ZtIALRhsI77BS1EagkHLrbhBtcnbN6/II3nMQDYbDIQa0DJfrbud6dX5hDRtoeIq2vKID/vDgy2Y+tbeJeWl7MYIUu4=
  file: debrief-$TRAVIS_TAG.zip
  on:
    repo: dandelionmood/debrief
    branch: feature/travis